"use strict";

$("#page1").load("../../dist/html/pubhead.html");
$("#page2").load("../../dist/html/pubfooter.html");
$.get("../../dist/JSON/indexshop.json", function (date) {
  var $arr = date;
  $('.shop-img').append("                <div class=\"row biglook\">\n                    <div id=\"small\">\n                        <div id=\"cover\"></div>\n                        <span id=\"docu\"></span>\n                        <img src=\"".concat($arr.q.thumbnail.q, "\"\n                            alt=\"\">\n                    </div>\n                    <div id=\"big\">\n                        <img src=\"").concat($arr.q.thumbnail.q, "\"\n                            alt=\"\" id=\"big_pic\">\n                    </div>\n                </div>\n                <!-- \u4E00\u884C\u7F29\u7565\u56FE -->\n                <div class=\"row smalllook\">\n                    <div class=\"img\">\n                        <ul class=\"slider-thumb\">\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.q, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.z, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.w, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.e, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"active\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.r, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.a, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.s, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.d, "\">\n                                    </span>\n                                </div>\n                            </li>\n                            <li class=\"\">\n                                <div class=\"thumb-item\">\n                                    <span>\n                                        <img\n                                            src=\"").concat($arr.q.thumbnail.f, "\">\n                                    </span>\n                                </div>\n                            </li>\n                        </ul>\n                    </div>\n                    <div class=\"btn666\"><i class=\"glyphicon glyphicon-menu-right\"></i></div>\n                </div>"));
  $('.shop-particulars').append("\n            \n                <div class=\"row\">\n                    <h1>\n                        ".concat($arr.q.name, "\n                    </h1>\n                </div>\n                <div class=\"row\">\n                    <div class=\"item-sub-title\">").concat($arr.q.introduce, "</div>\n                </div>\n                <div class=\"row pice\">\n                    <div class=\"row price\">\n                        <span class=\"one\">\uFFE5").concat($arr.q.price, "</span>\n                        <span href=\"javascripi:;\" class=\"two\">\u624B\u673A\u8D2D\u4E70\u2193\n                            <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAABlBMVEX///8AAABVwtN+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABI0lEQVQ4jc3TsW6DMBAG4EMevFTNymCJV0g2T/hVIvECqbqiQMUD8AI8jDvxGid56Eo2R7K4mqiiqoAeY277Buv8+84Az1SGfO+dEkR2oSNokwrR1Amn06ilDFC0tx0CmZHbJZ26rFlT7C49QjHfZVNTotSp4jfflmL15OA8P82m8lwbIPeT/a8MWe8DdeUVGCV36lFhNVw4TUc9OhQflpPxGpUqhmSpo7FAWahaYgXay+Ca4Y3TiXoDDkRglYwGJAgUNSz0moNPlcOXK6fk7g2F+NiPtP/q02qZZV01ACNIvE8dVjSuKM79i9T5UHOKu6SR4u6yeuwnxUTAKe68TafP2NpVIanyctghEyfWlRWn2J0QQb3fOMVEVgaBc/ZNPU99A6SdqbKN00sIAAAAAElFTkSuQmCC\"\n                                alt=\"\">\n                        </span>\n\n                    </div>\n                    <div class=\"row gift\">\n                        <div class=\"activity-wrap promotions-all-show\">\n                            <div class=\"dt\">\u4F18\u60E0\u4FE1\u606F\uFF1A</div>\n                            <div class=\"dd activity-content\">\n                                <div class=\"promotion-list more-gift\">\n                                    <div class=\"activity-txt\" data-skus=\"null\">\n                                        <span class=\"label-danger\">\u8D60\u54C1</span>\n                                        <a href=\"\">\n                                            <img\n                                                src=\"https://image.ztemall.com/ccb721e6cf0b2c9b230dc2315a9db838.jpg?x-oss-process=image/resize,w_440,h_440\">\n                                        </a>\n                                        x 1&nbsp;&nbsp;\n                                        <a href=\"\">\n                                            <img\n                                                src=\"https://image.ztemall.com/f9b8b9e1dd9c8017ca0a48d162e9b98b.jpg?x-oss-process=image/resize,w_440,h_440\">\n                                        </a>\n                                        x 1&nbsp;&nbsp;\n                                        <a href=\"\">\n                                            <img\n                                                src=\"https://image.ztemall.com/81eca476101fd2d4a4967dea24e80b4b.jpg?x-oss-process=image/resize,w_440,h_440\">\n                                        </a>\n                                        x 1&nbsp;&nbsp;\uFF08\u8D2D\u6EE11\u4EF6\u5373\u8D60\uFF0C\u8D60\u5B8C\u4E3A\u6B62\uFF09\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- \u9009\u62E9\u7C7B -->\n                <div class=\"category\">\n                    <div class=\"dashed\"></div>\n                    <div class=\"row  same color \">\n                        <div class=\"col-md-2 name\">\n                            \u989C\u8272\n                        </div>\n                        <div class=\"col-md-10\">\n                            <div class=\"col-md-4  imgimg\">\n                                <img src=\"").concat($arr.q.color.one.src, "\"\n                                    alt=\"").concat($arr.q.color.one.name, "\">\n                            </div>\n                            <div class=\"col-md-4  imgimg\">\n                                <img src=\"").concat($arr.q.color.two.src, "\"\n                                    alt=\"").concat($arr.q.color.two.name, "\">\n                            </div>\n                            <div class=\"col-md-4  imgimg\">\n                                <img src=\"").concat($arr.q.color.thr.src, "\"\n                                    alt=\"").concat($arr.q.color.thr.name, "\">\n                            </div>\n                            <div class=\"col-md-4  imgimg\">\n                                <img src=\"").concat($arr.q.color["for"].src, "\"\n                                    alt=\"").concat($arr.q.color["for"].name, "\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row  same edition \">\n                        <div class=\"col-md-2 name\">\n                            \u7248\u672C\n                        </div>\n                        <div class=\"col-md-10 \">\n                            <div class=\"col-md-4 typtyp\">\n                                ").concat($arr.q.edition.one, "\n                            </div>\n                            <div class=\"col-md-4 typtyp\">\n                                ").concat($arr.q.edition.two, "\n                            </div>\n                            <div class=\"col-md-4 typtyp\">\n                                ").concat($arr.q.edition.thr, "\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row  same network \">\n                        <div class=\"col-md-2 name\">\n                            \u7F51\u7EDC\u5236\u5F0F\n                        </div>\n                        <div class=\"col-md-10\">\n                            <div class=\"col-md-4 netnet\">\n                                ").concat($arr.q.network, "\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row  same has \">\n                        <div class=\"col-md-2 name\">\n                            \u5DF2\u9009\u62E9\u5546\u54C1\n                        </div>\n                        <div class=\"col-md-10\">\n                            <div class=\"hasShop\">\n                                1\u53F0\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row  same num \">\n                        <div class=\"col-md-2 name\">\n                            \u6570\u91CF\n                        </div>\n                        <div class=\"col-md-10\">\n                            <div class=\" buy-number\">\n                                <!-- <button type=\"button\" class=\"btn btn-reduct\">-</button> -->\n                                <a href=\"javascript:void(0);\" class=\"btnn btn-reduct\">-</a>\n                                <input type=\"text\" name=\"item[quantity]\" min=\"1\" max=\"5\" value=\"1\"\n                                    class=\"action-quantity-input\">\n                                <a href=\"javascript:void(0);\" class=\"btnn btn-add\">+</a>\n                                <!-- <button type=\"button\" class=\"btn btn-add\">+</button> -->\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row  buy \">\n                        <a href=\"javascript:;\" class=\"btnn btn-buy \">\n                            \u7ACB\u5373\u8D2D\u4E70\n                        </a>\n                        <a  href=\"javascript:;\" class=\"btnn btn-caution \">\n                            \u52A0\u5165\u8D2D\u7269\u8F66\n                        </a>\n                        <!-- <a href=\"javascript:void(0);\" class=\"btn btn-caution btn-xl btn-addcart action-open-dialog hide\">\n                                    <span><span>\u5230\u8D27\u901A\u77E5</span></span>\n                                </a> -->\n                    </div>\n                </div>"));
  $(document).ready(function () {
    var $sm_btn = $('.btn666');
    var $ul = $('.slider-thumb');
    var $li = $('.slider-thumb  li img');
    var $img = $('.biglook img');
    $li.mouseover(function () {
      var $src = $(this).attr('src');
      $img.attr('src', $src);
    }); // $sm_btn.css({ 'border': '1px solid red' }),

    $sm_btn.click(function () {
      if ($sm_btn.html() == '<i class="glyphicon glyphicon-menu-left"></i>') {
        $sm_btn.html('<i class="glyphicon glyphicon-menu-right"></i>');
        $ul.css({
          'left': "0px"
        });
      } else if ($sm_btn.html() == '<i class="glyphicon glyphicon-menu-right"></i>') {
        $sm_btn.html('<i class="glyphicon glyphicon-menu-left"></i>');
        $ul.css({
          'left': "-333px"
        });
      }
    });

    function Product() {
      //实例属性
      this.cart_btn = document.querySelector('.look  b'); //加购按钮

      this.buy = document.querySelector('.btn-caution'); // 数字

      this.num = document.querySelector('b'); //初始化方法（购物车中的数量

      this.init(); //添加事件

      this.addEvent();
    }

    Product.prototype = {
      constructor: Product,
      addEvent: function addEvent() {
        var that = this;

        that.buy.onclick = function () {
          alert('请先选择完整商品信息1');
        };

        this.cart_btn.parentNode.onclick = function () {
          location.href = '../../dist/html/index04.html';
        }; // 给每一个颜色框加点击事件 点击之后 图片信息放入一个地方里面 等等调用.


        var shop_name = '';
        var shop_src = '';
        var shop_pic = ''; //价格

        var shop_net = ''; //网络制式

        var shop_type = ''; //内存

        var yes = [1, 1, 1];
        var shop_num = document.querySelector('.action-quantity-input').value;
        var clas = document.querySelectorAll('.category  .col-md-4');

        for (var i = 0; i < clas.length; i++) {
          clas[i].onclick = function () {
            for (var j = 0; j < this.parentNode.children.length; j++) {
              this.parentNode.children[j].style.border = '1px solid #cbcbcb';
            }

            this.style.border = '1px solid #ca151d';

            if (this.getAttribute('class') === 'col-md-4  imgimg') {
              shop_name = this.children[0].getAttribute('alt');
              shop_src = this.children[0].getAttribute('src');
              yes[0] = 2;
            }

            if (this.getAttribute('class') === 'col-md-4 netnet') {
              shop_net = this.innerText;
              yes[1] = 2;
            }

            if (this.getAttribute('class') === 'col-md-4 typtyp') {
              shop_type = this.innerText;
              yes[2] = 2;
            }

            $('.hasShop').text("".concat(shop_name, " ").concat(shop_type, "  ").concat(shop_net, " ").concat(shop_num, "\u53F0"));

            that.buy.onclick = function () {
              if (yes.indexOf(1) == -1) {
                console.log('都选了'); //商品ID

                var good_name = $arr.q.name + shop_name + shop_type + shop_net; //商品缩略图

                var good_src = shop_src; //商品名称

                var good_color = shop_name; //商品价格

                var good_price = shop_pic; // 内存

                var good_type = shop_type; // 网络

                var good_net = shop_net; //判断本地存储中（购物车中）是否购买过当前商品

                /*
                    key : carts
                    value:
                    '{
                        "$arr.q.name" : {
                            "name" : "shop_name",
                            "price" : shop_pic,
                            "src" : "...",
                            "num" : 3，
                            "type" : shop_type，
                            "net" : shop_net，
                        }
                    }'
                */
                //获取本地存储中的数据

                var storage = window.localStorage;
                var storage_str = storage.getItem('carts') ? storage.getItem('carts') : ''; //转对象

                var storage_obj = that.convertStrToObj(storage_str); //判断当前商品是否存在

                if (good_name in storage_obj) {
                  //如果在，找到当前商品的数量+ 1
                  storage_obj[good_name].num++;
                } else {
                  // 如果不存在
                  storage_obj[good_name] = {
                    "color": good_color,
                    "price": good_price,
                    "src": good_src,
                    "num": 1,
                    "type": good_type,
                    "net": good_net
                  }; //创建storage
                  // storage.setItem('carts', JSON.stringify(storage_obj));
                } //创建storage


                storage.setItem('carts', JSON.stringify(storage_obj));
                alert('加入成功'); // 改变购物车按钮中的数量

                var num = /(\d+)/.exec(that.cart_btn.innerText)[1]; // alert(num);

                that.cart_btn.innerText = "".concat(++num);
              } else {
                console.log('没选完');
                alert('请先选择完整商品信息2');
                console.log(yes);
              }
            };
          };
        }
      },
      init: function init() {
        var that = this; //获取本地存储中的数据

        var storage = window.localStorage;
        var storage_str = storage.getItem('carts') ? storage.getItem('carts') : ''; //转对象

        var storage_obj = this.convertStrToObj(storage_str);
        var sum = 0; //遍历对象

        for (var key in storage_obj) {
          sum += storage_obj[key].num;
        }

        that.num.innerText = "".concat(sum); // console.log(that.num.innerText);
      },
      convertStrToObj: function convertStrToObj(str) {
        if (!str) {
          return {};
        }

        return JSON.parse(str);
      }
    };
    new Product();
  });
});